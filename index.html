<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Med List</title>

    <style>

       body {

    background-color: #121212;

    color: #ffffff;

      font-family: monospace, monospace;

    margin: auto;

    padding: 20px;

}



.container {

    width: 100%;

    max-width: 900px;

    margin: auto;

    padding: 20px;

}





       .search-container {

            display: none; /* Hidden by default */

            margin-top: 10px;

        }



        #searchInput {

            padding: 10px;

            font-size: 1.1em;

            border: none;

            border-radius: 8px;

            width: 250px;

            margin-right: 10px;

        }







        

button {

    padding: 10px 20px;

    background-color: #1976d2;

    color: white;

    border: none;

    border-radius: 8px;

    cursor: pointer;

    font-size: 1.1em;

}



button:hover {

    background-color: #145a9d;

}







        

        

h1 {

    text-align: center;

    font-size: 2em;

}



input[type="file"] {

    display: block;

    margin: 20px auto;

}



.row-list {

    list-style: none;

    padding: 0;

}



.row-item {

    background-color: #1e1e1e;

    padding: 15px;

    margin: 8px 0;

    cursor: pointer;

    border-radius: 8px;

    font-size: 1.2em;

    word-wrap: break-word;

    display: grid;

    grid-template-columns: repeat(5, 1fr);

    gap: 10px;

    align-items: center;

}



.row-item:hover {

    background-color: #333333;

}



.details-view {

    display: none;

    position: fixed;

    top: 0;

    left: 0;

    width: 100%;

    height: 100%;

    background-color: #222222;

    padding: 20px;

    overflow-y: auto;

    box-sizing: border-box;

    z-index: 1000;

}



#editForm {

    display: flex;

    flex-direction: column;

    align-items: center;

    width: 100%;

    max-width: 800px;

    margin: 0 auto;

}



label {

    display: block;

    text-align: center;

    margin-top: 10px;

    font-size: 1.2em;

}



textarea {

    width: 90%;

    max-width: 800px;

    padding: 10px;

    background-color: #333333;

    color: #ffffff;

    border: 1px solid #444444;

    border-radius: 1px;

    font-size: 1.5em;

    margin: 10px auto;

    box-sizing: border-box;

    overflow-y: hidden; /* Hide vertical scrollbar */

    resize: none; /* Prevent manual resizing */

    font-family: monospace, monospace;

}









.nav-buttons {

    display: flex;

    justify-content: center;

    gap: 20px;

    margin-top: 20px;

}



button {

    padding: 15px 25px;

    background-color: #1976d2;

    color: white;

    border: none;

    border-radius: 8px;

    font-size: 1.1em;

    cursor: pointer;

}



button:hover {

    background-color: #145a9d;

}



select {

    margin-top: 20px;

    padding: 15px;

    background-color: #333333;

    color: white;

    border: none;

    border-radius: 8px;

    font-size: 1.1em;

}



.column-selector {

    display: flex;

    flex-wrap: wrap;

   gap: 5px;

    margin-bottom: 10px;

}









        .column-button {

    padding: 8px; /* Smaller padding */

    margin: 5px;

    background-color: #444444;

    border: 1px solid #666666;

    border-radius: 8px;

    cursor: pointer;

    color: white;

    font-size: 0.9em; /* Decrease font size */

    text-align: center;

    flex: 1 0 22%;

    box-sizing: border-box;

}







        



.column-button.selected {

    background-color: #28a745;

    border-color: #28a745;

}



#exportButton {

    position: flex;

    top: 20px;

    right: 20px;

    z-index: 999;

    padding: 10px 20px;

    background-color: #1976d2;

    color: white;

    border: none;

    border-radius: 8px;

    font-size: 1em;

    cursor: pointer;

}









        .sticky-text {

    position: sticky;

    top: 0;

    background-color: #222222;

    padding: 10px;

    font-size: 1.5em;

    text-align: center;

    z-index: 10;

    border-bottom: 1px solid #444444;

    box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.5);

}







        

/* Light Color Scheme */

.colored-text-1 { color: #00e5ff; }

.colored-text-2 { color: #f26363; }

.colored-text-3 { color: #79e89f; }

.colored-text-4 { color: #ffffff; }

.colored-text-5 { color: #ff8000; }

.colored-text-6 { color: #f6ff00; }

.colored-text-7 { color: #da05ff; }

.colored-text-8 { color: #7a05ff; }

.colored-text-9 { color: #9ab6e2; }

.colored-text-10 { color: #f5a623; }



/* Delete Button */

.delete-button {

    background-color: #e53935;

    border: none;

    color: white;

    padding: 10px 20px;

    border-radius: 5px;

    cursor: pointer;

    margin-top: 20px;

}



.delete-button:hover {

    background-color: #c62828;

}



/* Modal for adding new entry */

.modal {

    display: none;

    position: fixed;

    z-index: 1000;

    left: 0;

    top: 0;

    width: 100%;

    height: 100%;

    background-color: rgba(0, 0, 0, 0.5);

    padding-top: 60px;

}



.modal-content {

    background-color: #333333;

    margin: auto;

    padding: 20px;

    border: 1px solid #888;

    width: 80%;

    max-width: 500px;

    color: white;

    border-radius: 8px;

}









/* Media Queries for Mobile */

@media (max-width: 768px) {

    .container {

        padding: 10px;

    }



    textarea {

        font-size: 1.4em; /* Increase size for mobile */

    }



    button, select {

        width: 100%;

        font-size: 1.1em;

    }



    .row-item {

        font-size: 1em;

        grid-template-columns: repeat(1, 1fr);

    }



    .column-button {

        flex: 1 0 46%;

    }



}



@media (max-width: 480px) {

    textarea {

        font-size: 1.2em; /* Further increase for small screens */

    }



    .modal-content {

        width: 95%; /* Make modal full width on small screens */

    }

}



















        



    </style>

</head>

<body>

    <div class="container">

        <input type="file" id="fileInput" accept=".csv">



        <div class="dropdown-toggle">

  <button onclick="toggleColumnDropdown()">⚙️ Row Label Options ▼</button>

  <div id="columnDropdown" style="display: none; margin-top: 10px;">

    <div id="columnSelector"></div>

  </div>

        </div> 

        <select id="columnSelect" onchange="sortRows()">

            <option value="">Select Column to Sort</option>

        </select>

        

            <!-- Button to toggle the search field -->

            <button onclick="toggleSearch()">Search</button>



            <!-- Search input, Enter button, and Clear button (initially hidden) -->

            <div id="searchContainer" class="search-container">

                <input type="text" id="searchInput" placeholder="Type your search..." />

                <button onclick="searchRows()">Enter</button>

                <button onclick="clearSearch()">Clear</button>

            </div>





    

<button onclick="resortRows()">Re-sort</button>

                <!-- Add Entry Button -->

        <button onclick="showAddEntryModal()">Add New Entry</button>

 <button id="exportButtonMain" onclick="exportCSV()">Export CSV</button>

        <!-- Add this button somewhere appropriate in your HTML, for example near the export button or below the sort dropdown -->

        

        

        <ul class="row-list" id="rowList"></ul>

        <!-- Search Bar Section -->









        <!-- Add Entry Modal -->

        <div id="addEntryModal" class="modal">

            <div class="modal-content">

                <h2>Add New Entry</h2>

                <form id="addEntryForm" onsubmit="addEntry(event)">

                    <div id="newEntryFields"></div>

                    <button type="submit">Save Entry</button>

                    <button type="button" onclick="closeAddEntryModal()">Cancel</button>

                </form>

            </div>

        </div>







        



        <div class="details-view" id="detailsView">

            <div class="details-header">

                <button onclick="backToList()">Back to List</button> 

            </div>



            <div id="stickyTextContainer" class="sticky-text"></div>



            <form id="editForm"></form>

            <div class="nav-buttons">

                <button id="prevButton" onclick="navigateDetails(-1)">Previous</button>

                <button id="nextButton" onclick="navigateDetails(1)">Next</button>

                 <button onclick="backToList()">Back to List</button>

<!-- Note generation buttons -->
<div style="display: flex; gap: 10px; margin-top: 20px;">
  <button style="padding: 6px 12px;" onclick="generateNoteRTF('consult')">Consult Note</button>
  <button style="padding: 6px 12px;" onclick="generateNoteRTF('trauma')">Trauma Note</button>
</div>




            </div>

            

            <br> </br>

            

    <div>

            <button id="exportButton" onclick="exportCSV()">Export CSV</button>

    </div>

            

            <button class="delete-button" onclick="deleteCurrentEntry()">Delete Entry</button>

        </div>

    </div>



    <!-- Include Papa Parse from CDN -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>



    <script>

        let parsedData = [];

        let headers = [];

        let currentRowIndex = -1;

        let selectedColumns = [0, 1, 2];



        const colors = [

            'colored-text-1', 'colored-text-2', 'colored-text-3',

            'colored-text-4', 'colored-text-5', 'colored-text-6',

            'colored-text-7', 'colored-text-8', 'colored-text-9',

            'colored-text-10'

        ];



        document.getElementById('fileInput').addEventListener('change', function(event) {

            const file = event.target.files[0];

            if (file) {

                Papa.parse(file, {

                    complete: function(results) {

                        parsedData = results.data.slice(1);

                        headers = results.data[0];

                        populateColumnSelector();

                        populateColumnSelect();

                        displayRows();

                        saveCSVToLocalStorage();

                    },

                    error: function(error) {

                        console.error('Error parsing CSV:', error);

                    },

                    header: false,

                    skipEmptyLines: true

                });

            }

        });



        function populateColumnSelector() {

            const columnSelector = document.getElementById('columnSelector');

            columnSelector.innerHTML = '';

            headers.forEach((header, colIndex) => {

                const button = document.createElement('div');

                button.className = 'column-button';

                button.textContent = header;

                if (selectedColumns.includes(colIndex)) {

                    button.classList.add('selected');

                }

                button.onclick = () => toggleColumnSelection(colIndex, button);

                columnSelector.appendChild(button);

            });

        }



        function toggleColumnSelection(colIndex, button) {

            if (selectedColumns.includes(colIndex)) {

                selectedColumns = selectedColumns.filter(col => col !== colIndex);

                button.classList.remove('selected');

            } else {

                selectedColumns.push(colIndex);

                button.classList.add('selected');

            }

            displayRows();

        }



        function populateColumnSelect() {

            const columnSelect = document.getElementById('columnSelect');

            columnSelect.innerHTML = '<option value="">Select Column to Sort</option>';

            headers.forEach((header, colIndex) => {

                const option = document.createElement('option');

                option.value = colIndex;

                option.textContent = header;

                columnSelect.appendChild(option);

            });

        }



        function displayRows() {

            const rowList = document.getElementById('rowList');

            rowList.innerHTML = '';

            parsedData.forEach((row, index) => {

                const listItem = document.createElement('li');

                listItem.className = 'row-item';

                listItem.innerHTML = `${selectedColumns.map((colIndex, idx) => `<span class="${colors[idx % colors.length]}">${row[colIndex]}</span>`).join(' ')}`;

                listItem.onclick = () => showDetails(index);

                rowList.appendChild(listItem);

            });

        }



        function sortRows() {

            const columnIndex = document.getElementById('columnSelect').value;

            if (columnIndex !== "") {

                parsedData.sort((a, b) => {

                    const valueA = a[columnIndex] ? a[columnIndex].toLowerCase() : "";

                    const valueB = b[columnIndex] ? b[columnIndex].toLowerCase() : "";



                    if (valueA === "" && valueB === "") return 0;

                    if (valueA === "") return 1;

                    if (valueB === "") return -1;



                    return valueA.localeCompare(valueB);

                });

                displayRows();

            }

        }







        function navigateDetails(step) {

            const newIndex = currentRowIndex + step;

            if (newIndex >= 0 && newIndex < parsedData.length) {

                showDetails(newIndex);

            }

        }



        function updateNavButtons() {

            document.getElementById('prevButton').disabled = currentRowIndex === 0;

            document.getElementById('nextButton').disabled = currentRowIndex === parsedData.length - 1;

        }



        function backToList() {

            document.getElementById('detailsView').style.display = 'none';

        }



        function exportCSV() {

            const now = new Date();

            const formattedDate = String(now.getMonth() + 1).padStart(2, '0') + "." +

                String(now.getDate()).padStart(2, '0') + "." +

                String(now.getFullYear()).slice(-2);



            const filename = `list_${formattedDate}.csv`;

            const csvContent = Papa.unparse([headers, ...parsedData]);



            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });

            const link = document.createElement('a');

            link.setAttribute('href', URL.createObjectURL(blob));

            link.setAttribute('download', filename);

            document.body.appendChild(link);

            link.click();

            document.body.removeChild(link);

        }



        function deleteCurrentEntry() {

            if (currentRowIndex !== -1) {

                const confirmDeletion = confirm("Are you sure you want to delete this entry?");

                if (confirmDeletion) {

                    parsedData.splice(currentRowIndex, 1);

                    backToList();

                    displayRows();

                    saveCSVToLocalStorage();

                } else {

                    console.log("Deletion canceled");

                }

            }

        }



        function addEntry(event) {

            event.preventDefault();

            const newEntry = [];

            const fields = document.querySelectorAll('#newEntryFields input');

            fields.forEach((field) => {

                newEntry.push(field.value.trim());

                field.value = '';

            });



            if (newEntry.every((value) => value === '')) {

                alert('Please fill out at least one field.');

                return;

            }



            parsedData.push(newEntry);

            displayRows();

            saveCSVToLocalStorage();

            closeAddEntryModal();

        }



        function generateNewEntryFields() {

            const newEntryFields = document.getElementById('newEntryFields');

            newEntryFields.innerHTML = '';



            headers.forEach((header) => {

                const input = document.createElement('input');

                input.placeholder = header;

                newEntryFields.appendChild(input);

            });

        }



        function showAddEntryModal() {

            document.getElementById('addEntryModal').style.display = 'block';

            generateNewEntryFields();

        }



        function closeAddEntryModal() {

            document.getElementById('addEntryModal').style.display = 'none';

        }



        function saveCSVToLocalStorage() {

            const csvContent = Papa.unparse([headers, ...parsedData]);

            localStorage.setItem('csvData', csvContent);

            console.log("Data saved to localStorage.");

        }



        function loadCSVFromLocalStorage() {

            const savedData = localStorage.getItem('csvData');

            if (savedData) {

                const results = Papa.parse(savedData, { header: false });

                parsedData = results.data.slice(1);

                headers = results.data[0];



                populateColumnSelector();

                populateColumnSelect();

                displayRows();

                console.log("Data loaded from localStorage.");

            } else {

                console.log("No saved data found in localStorage.");

            }

        }



        window.onload = function() {

            loadCSVFromLocalStorage();

        };











        

function resortRows() {

    // Get the current column index from the selected option

    const columnIndex = document.getElementById('columnSelect').value;

    

    if (columnIndex !== "") {

        // Re-apply the sorting logic based on the selected column index

        parsedData.sort((a, b) => {

            let valueA = a[columnIndex] ? a[columnIndex].toLowerCase() : "";

            let valueB = b[columnIndex] ? b[columnIndex].toLowerCase() : "";



            // Sort blanks to the bottom

            if (valueA === "" && valueB === "") return 0;

            if (valueA === "") return 1;

            if (valueB === "") return -1;



            // Check if both values are numbers and sort numerically if so

            const numA = parseFloat(valueA);

            const numB = parseFloat(valueB);



            if (!isNaN(numA) && !isNaN(numB)) {

                // Both are numbers, so compare them numerically

                return numA - numB;

            }



            // If not both numbers, sort alphabetically

            return valueA.localeCompare(valueB);

        });



        // Redisplay the rows after sorting

        displayRows();

    }

}















        







        

 function toggleSearch() {

                const searchContainer = document.getElementById('searchContainer');

                if (searchContainer.style.display === 'none' || searchContainer.style.display === '') {

                    searchContainer.style.display = 'block'; // Show the search input

                    document.getElementById('searchInput').focus(); // Focus on the input when it appears

                } else {

                    searchContainer.style.display = 'none'; // Hide the search input

                }

            }



            function searchRows() {

                const searchTerm = document.getElementById('searchInput').value.toLowerCase();

                filteredIndexes = []; // Reset the filtered index array



                if (!searchTerm) {

                    alert("Please enter a search term.");

                    return;

                }



                // Filter the parsedData based on the search term

                const filteredData = parsedData.filter((row, index) => {

                    const matchFound = row.some(colValue => colValue.toLowerCase().includes(searchTerm));

                    if (matchFound) {

                        filteredIndexes.push(index); // Track the index of the filtered data

                    }

                    return matchFound;

                });



                if (filteredData.length > 0) {

                    displayFilteredRows(filteredData);

                } else {

                    displayFilteredRows([]);

                }

            }



            function clearSearch() {

                document.getElementById('searchInput').value = '';

                displayRows(); // Go back to displaying the original full data

                document.getElementById('searchContainer').style.display = 'none'; // Hide search input after clearing

            }



            function displayFilteredRows(filteredData) {

                const rowList = document.getElementById('rowList');

                rowList.innerHTML = ''; // Clear current rows



                if (filteredData.length === 0) {

                    const noResultsItem = document.createElement('li');

                    noResultsItem.className = 'row-item';

                    noResultsItem.style.textAlign = 'center';

                    noResultsItem.style.fontSize = '1.2em';

                    noResultsItem.style.color = '#ff5c5c';

                    noResultsItem.textContent = 'No results found';

                    rowList.appendChild(noResultsItem);

                } else {

                    filteredData.forEach((row, filteredIndex) => {

                        const listItem = document.createElement('li');

                        listItem.className = 'row-item';

                        listItem.innerHTML = `${selectedColumns.map((colIndex, idx) => `<span class="${colors[idx % colors.length]}">${row[colIndex]}</span>`).join(' ')}`;

                        listItem.onclick = () => showDetails(filteredIndexes[filteredIndex]);

                        rowList.appendChild(listItem);

                    });

                }

            }









// Function to auto-resize a textarea based on its content

function autoResizeTextarea(textarea) {

    textarea.style.height = 'auto'; // Reset height so it recalculates

    textarea.style.height = textarea.scrollHeight + 'px'; // Set height based on content and line breaks

}









   // Updated showDetails function to include a sticky label for the title

    function showDetails(index) {

        currentRowIndex = index; // Set the current row index to match the selected row

        const detailsView = document.getElementById('detailsView');

        const form = document.getElementById('editForm');

        const stickyTextContainer = document.getElementById('stickyTextContainer');



        form.innerHTML = ''; // Clear previous form content



        // Create and set up a sticky label for the title (first column)

        const title = parsedData[index][0]; // Assuming the first column holds the title

        stickyTextContainer.innerHTML = `<span class="sticky-title">${title}</span>`; // Set sticky label text



        // Add a text area for the title as the first editable field

        const titleLabel = document.createElement('label');

        const titleTextarea = document.createElement('textarea');

        titleTextarea.value = title; // Set the value from the CSV

        titleTextarea.setAttribute('data-col-index', 0); // Set the column index for the title



        form.appendChild(titleLabel);

        form.appendChild(titleTextarea);



        // Add input listener for resizing the title textarea and saving the updated value

        titleTextarea.addEventListener('input', function () {

            autoResizeTextarea(this); // Resize dynamically as text changes

            const colIndex = this.getAttribute('data-col-index');

            parsedData[currentRowIndex][colIndex] = this.value; // Save the updated title

            stickyTextContainer.innerHTML = `<span class="sticky-title">${this.value}</span>`; // Update sticky label

            saveCSVToLocalStorage(); // Save changes to local storage

            displayRows(); // Update the main list to reflect changes

        });



        // Loop through the parsed data for the other columns

        parsedData[index].forEach((value, colIndex) => {

            if (colIndex !== 0) { // Skip the first column (title)

                const label = document.createElement('label');

                label.textContent = headers[colIndex]; // Display the header for each column



                const textarea = document.createElement('textarea');

                textarea.value = value; // Set the value from the CSV

                textarea.setAttribute('data-col-index', colIndex);



                form.appendChild(label);

                form.appendChild(textarea);



                // Add input listener to resize as user types and save the updated value

                textarea.addEventListener('input', function () {

                    autoResizeTextarea(this); // Resize dynamically as text changes

                    const colIndex = this.getAttribute('data-col-index');

                    parsedData[currentRowIndex][colIndex] = this.value; // Save the updated data

                    saveCSVToLocalStorage(); // Save changes to local storage

                    displayRows(); // Update the main list to reflect changes

                });

            }

        });



        detailsView.style.display = 'block';

        updateNavButtons(); // Update the navigation buttons (Previous/Next)



        // Resize text areas after rendering

        setTimeout(() => {

            const textareas = form.querySelectorAll('textarea');

            textareas.forEach(textarea => autoResizeTextarea(textarea));

        }, 100);

    }



    // Function to auto-resize a textarea based on its content

    function autoResizeTextarea(textarea) {

        textarea.style.height = 'auto'; // Reset height so it recalculates

        textarea.style.height = textarea.scrollHeight + 'px'; // Set height based on content and line breaks

    }



    // Function to save the CSV data to localStorage

    function saveCSVToLocalStorage() {

        const csvContent = Papa.unparse([headers, ...parsedData]);

        localStorage.setItem('csvData', csvContent);

        console.log("Data saved to localStorage.");

    }









        function toggleColumnDropdown() {

    const dropdown = document.getElementById('columnDropdown');

    dropdown.style.display = dropdown.style.display === 'none' || dropdown.style.display === ''

        ? 'block'

        : 'none';

}



function generateNoteRTF(type) {
    if (currentRowIndex === -1) {
        alert("No patient selected.");
        return;
    }

    const row = parsedData[currentRowIndex];
    const get = (i) => (row[i] && row[i].trim()) || "";

    const ageGender = get(3);   // A/G
    const cc = get(4);          // CC
    const hpi = get(5);         // HPI
    const ros = get(6);         // ROS
    const pmh = get(7);         // PMH
    const meds = get(8);
    const all = get(9);
    const surghx = get(10);
    const fsh = get(11);        // FamHx/Sochx/HCM
    const violin = get(12);     // Labs/imaging
    const pe = get(13);         // PE
    const plan = get(14);       // Plan

    const pmhPhrase = pmh ? `with PMH ${pmh}` : "with no PMH";

    let finalLine = `\\i Final plan pending attending approval signature.\\i0\\par`;

    let noteText = "";

    if (type === "consult") {
        noteText = 
`\\b\\ul Surgery Initial Consultation Note:\\ul0\\b0\\par\\par
\\b\\ul CC:\\ul0\\b0  ${cc}\\par\\par
\\b\\ul Subjective:\\ul0\\b0\\par
HPI:  ${ageGender} ${pmhPhrase} ${hpi}\\par\\par
ROS:  ${ros}\\par.rosgen\\par\\par
Meds:  ${meds}\\par
All:  ${all}\\par
Surghx:  ${surghx}\\par
FamHx/Sochx/HCM:  ${fsh}\\par\\par
\\b\\ul Objective:\\ul0\\b0\\par
Physical Exam:  ${pe}\\par.pe\\par
Labs/imaging:  ${violin}\\par\\par
\\b\\ul Assessment:\\ul0\\b0\\par
${ageGender} ${pmhPhrase}, surgery consulted for ${cc}\\par\\par
\\b\\ul Plan:\\ul0\\b0\\par
${plan}\\par.plan\\par
${finalLine}`;
    } else if (type === "trauma") {
        noteText =
`\\b\\ul Trauma Initial Evaluation/Consult Note:\\ul0\\b0\\par\\par
\\b\\ul Activation: \\ul0\\b0 ${cc}\\par\\par
\\b\\ul Subjective:\\ul0\\b0\\par
${ageGender} ${pmhPhrase} s/p ${hpi}\\par
\\b Primary Survey:\\b0  Airway intact. b/l breath sounds present. Hemodynamically stable, palpable femoral/radial pulses, extremities wwp, GCS 15 (E4 V5 M6)\\par
\\b Secondary Survey:\\b0  ${ros}\\par
\\b FAST:\\b0  no intra-abdominal free fluid noted\\par
\\b CXR:\\b0  no HTX, no PTX\\par
\\b Pelvic XR:\\b0  no obvious fractures or dislocation\\par\\par
\\b Meds:\\b0  ${meds}\\par
\\b All:\\b0  ${all}\\par
\\b Surghx:\\b0  ${surghx}\\par
\\b FamHx/Sochx/HCM:\\b0  ${fsh}\\par\\par
\\b\\ul Objective:\\ul0\\b0\\par
\\b Physical Exam:\\b0  ${pe}\\par.petrauma\\par\\par
\\b\\ul Assessment:\\ul0\\b0\\par
${ageGender} ${pmhPhrase} s/p ${hpi}\\par
INJURIES:\\par${violin}\\par\\par
\\b\\ul Plan:\\ul0\\b0\\par
${plan}\\par.plantrauma\\par
${finalLine}`;
    }

    const now = new Date();
    const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}`;
    const filename = type === "consult" ? `consult_note_${timestamp}.rtf` : `trauma_note_${timestamp}.rtf`;

    const rtf = `{\\rtf1\\ansi\\deff0\n${noteText}}`;
    const blob = new Blob([rtf], { type: 'application/rtf' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}











</script>


</body>

</html>
